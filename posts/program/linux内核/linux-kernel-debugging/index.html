<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="UMLè°ƒè¯•Linuxå†…æ ¸ æœ€è¿‘çœ‹äº†äº›Linuxå†…æ ¸æºç ï¼Œä¹‹å‰è®¤ä¸ºæœ€å¥½çš„è°ƒè¯•å†…æ ¸æºç æœ€å¥½çš„æ–¹å¼ä½¿ç”¨Qemuè™šæ‹Ÿæœºï¼Œç»“åˆGDBè°ƒè¯•ï¼Œè™½ç„¶åœ¨ç½‘ä¸Šä¹Ÿçœ‹åˆ°ä¸€äº›è¿™ç§è°ƒè¯•æ–¹å¼çš„å¼Šç«¯ï¼Œä½†æ„Ÿè§‰è™šæ‹Ÿæœºæ”¯æŒè°ƒè¯•æ˜¯æœ€å®Œç¾çš„äº‹æƒ…ï¼Œè™½ç„¶Bochsæ›´ä¸ºçµæ´»ç”šè‡³å†…ç½®è°ƒè¯•å™¨ï¼Œä½†é€Ÿåº¦å¤ªæ…¢ã€‚\n">
<title>Linux å†…æ ¸è°ƒè¯•</title>

<link rel='canonical' href='https://drawing.fancymore.com/posts/program/linux%E5%86%85%E6%A0%B8/linux-kernel-debugging/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Linux å†…æ ¸è°ƒè¯•">
<meta property='og:description' content="UMLè°ƒè¯•Linuxå†…æ ¸ æœ€è¿‘çœ‹äº†äº›Linuxå†…æ ¸æºç ï¼Œä¹‹å‰è®¤ä¸ºæœ€å¥½çš„è°ƒè¯•å†…æ ¸æºç æœ€å¥½çš„æ–¹å¼ä½¿ç”¨Qemuè™šæ‹Ÿæœºï¼Œç»“åˆGDBè°ƒè¯•ï¼Œè™½ç„¶åœ¨ç½‘ä¸Šä¹Ÿçœ‹åˆ°ä¸€äº›è¿™ç§è°ƒè¯•æ–¹å¼çš„å¼Šç«¯ï¼Œä½†æ„Ÿè§‰è™šæ‹Ÿæœºæ”¯æŒè°ƒè¯•æ˜¯æœ€å®Œç¾çš„äº‹æƒ…ï¼Œè™½ç„¶Bochsæ›´ä¸ºçµæ´»ç”šè‡³å†…ç½®è°ƒè¯•å™¨ï¼Œä½†é€Ÿåº¦å¤ªæ…¢ã€‚\n">
<meta property='og:url' content='https://drawing.fancymore.com/posts/program/linux%E5%86%85%E6%A0%B8/linux-kernel-debugging/'>
<meta property='og:site_name' content='æ¶¸æ³½ä¹‹é±¼'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='Linuxå†…æ ¸' /><meta property='article:published_time' content='2014-05-19T01:16:33&#43;08:00'/><meta property='article:modified_time' content='2014-05-19T01:16:33&#43;08:00'/>
<meta name="twitter:title" content="Linux å†…æ ¸è°ƒè¯•">
<meta name="twitter:description" content="UMLè°ƒè¯•Linuxå†…æ ¸ æœ€è¿‘çœ‹äº†äº›Linuxå†…æ ¸æºç ï¼Œä¹‹å‰è®¤ä¸ºæœ€å¥½çš„è°ƒè¯•å†…æ ¸æºç æœ€å¥½çš„æ–¹å¼ä½¿ç”¨Qemuè™šæ‹Ÿæœºï¼Œç»“åˆGDBè°ƒè¯•ï¼Œè™½ç„¶åœ¨ç½‘ä¸Šä¹Ÿçœ‹åˆ°ä¸€äº›è¿™ç§è°ƒè¯•æ–¹å¼çš„å¼Šç«¯ï¼Œä½†æ„Ÿè§‰è™šæ‹Ÿæœºæ”¯æŒè°ƒè¯•æ˜¯æœ€å®Œç¾çš„äº‹æƒ…ï¼Œè™½ç„¶Bochsæ›´ä¸ºçµæ´»ç”šè‡³å†…ç½®è°ƒè¯•å™¨ï¼Œä½†é€Ÿåº¦å¤ªæ…¢ã€‚\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/images/avatar_hu_50b065d24a9bf4d8.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ“–</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">æ¶¸æ³½ä¹‹é±¼</a></h1>
            <h2 class="site-description">æ¶¸æ³½ä¹‹é±¼ï¼ŒçŠ¹å¸Œå‡æ°´ã€‚</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/drawing/'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E7%BC%96%E7%A8%8B/" >
                ç¼–ç¨‹
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/program/linux%E5%86%85%E6%A0%B8/linux-kernel-debugging/">Linux å†…æ ¸è°ƒè¯•</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 19, 2014</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 14 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="umlè°ƒè¯•linuxå†…æ ¸">UMLè°ƒè¯•Linuxå†…æ ¸
</h1><p>æœ€è¿‘çœ‹äº†äº›Linuxå†…æ ¸æºç ï¼Œä¹‹å‰è®¤ä¸ºæœ€å¥½çš„è°ƒè¯•å†…æ ¸æºç æœ€å¥½çš„æ–¹å¼ä½¿ç”¨Qemuè™šæ‹Ÿæœºï¼Œç»“åˆGDBè°ƒè¯•ï¼Œè™½ç„¶åœ¨ç½‘ä¸Šä¹Ÿçœ‹åˆ°ä¸€äº›è¿™ç§è°ƒè¯•æ–¹å¼çš„å¼Šç«¯ï¼Œä½†æ„Ÿè§‰è™šæ‹Ÿæœºæ”¯æŒè°ƒè¯•æ˜¯æœ€å®Œç¾çš„äº‹æƒ…ï¼Œè™½ç„¶Bochsæ›´ä¸ºçµæ´»ç”šè‡³å†…ç½®è°ƒè¯•å™¨ï¼Œä½†é€Ÿåº¦å¤ªæ…¢ã€‚</p>
<p>ä¹‹ å‰ä¸€ç›´è§‰å¾—KGDBè¿™ç§åŒæœºè°ƒè¯•çš„æ–¹å¼å¾ˆä¸å®Œç¾ï¼Œè¿˜å¿…é¡»ä½¿ç”¨ä¸€ä¸ªè°ƒè¯•æœºï¼Œä¸è¿‡åœ¨Windowsä¸‹ä½¿ç”¨WinDbgè°ƒè¯•è™šæ‹Ÿæœºå¤šäº†ï¼Œæ„Ÿè§‰è¿™ç§æ–¹å¼å¾ˆåˆç†ï¼Œèµ· ç è¢«è°ƒè¯•æœºå½“æœºçš„æƒ…å†µä¸‹ï¼Œè°ƒè¯•æœºè¿˜æ˜¯æ´»çš„ã€‚è€Œä¸”è¿™æ ·çœ‹ä¸Šå»å¾ˆé…·ï¼Œè€Œä¸”æ¯”SoftICEè¿™æ ·â€œä¸ç¨³å®šâ€çš„è°ƒè¯•æ–¹å¼è¦å¥½çš„å¤šã€‚</p>
<p>è¿™ä¸¤å¤©çœ‹åˆ°ä¸€ç§ UMLï¼ˆUser Mode Linuxï¼‰çš„è°ƒè¯•æ–¹å¼ï¼Œå±…ç„¶æ—©å·²åŠ å…¥å†…æ ¸ï¼Œæˆ‘æ‰å¬é—»ï¼ŒçœŸæ˜¯è½åæ—¶ä»£å•Šã€‚è¿™ç§UMLæ–¹å¼æ˜¯æŠŠlinuxå†…æ ¸å½“ä½œæœ¬åœ°ä¸€ä¸ªæ™®é€šçš„åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œå½“ç„¶ä¹Ÿå¾ˆæ–¹ä¾¿ è°ƒè¯•ï¼Œè¿™ä¸ªç±»ä¼¼äºXenè™šæ‹Ÿæœºã€‚ä¸è¿‡åœ¨64ä½Fedoraä¸Šæ²¡æœ‰é…å¥½ç¯å¢ƒï¼Œåœ¨i386å´å¾ˆå®¹æ˜“é…ç½®ï¼Œæ‰“å¼€æ§åˆ¶å°è½¬åˆ°å†…æ ¸æºç ï¼Œä¾‹å¦‚<code>linux- 2.6.34</code>:</p>
<p>ç¼–è¯‘å†…æ ¸å‘½ä»¤è¦åœ¨æ™®é€šæ–¹å¼ååŠ å…¥æ„æ¶umå‚æ•°ï¼š</p>
<pre><code># é…ç½®å†…æ ¸
make menuconfig ARCH=um
# ç¼–è¯‘å†…æ ¸
make linux ARCH=um
</code></pre>
<p>ç¼–è¯‘å®Œæˆåä¼šåœ¨æºç æ ¹ç›®å½•ä¸‹ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ linuxã€‚</p>
<p>åˆ°è¿™é‡Œä¼¼ä¹å¾ˆç®€å•ï¼Œä¸‹é¢éœ€è¦åˆ›å»º Linux æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯é™¤å†…æ ¸ä»¥å¤–çš„ç¡¬ç›˜æ–‡ä»¶ï¼Œè¿™ä¸ªæ ¹æ–‡ä»¶ç³»ç»ŸåŒ…æ‹¬Linuxæ–‡ä»¶ç»„ç»‡æ•°ï¼Œä»¥åŠå¯åŠ¨ç³»ç»Ÿæ‰€å¿…é¡»çš„ä¸€äº›è¾…åŠ©ç¨‹åºã€‚</p>
<p>ä¸€ç§æ–¹æ³•å°±æ˜¯æ‰‹å·¥åˆ¶ä½œï¼š</p>
<pre><code># åˆ›å»ºä¸€ä¸ª2Gçš„æ–‡ä»¶ä½œä¸ºç¡¬ç›˜
dd if=/dev/zero of=rootfs.img bs=1M count=2048
# æ ¼å¼åŒ–æ–‡ä»¶
mkfs.ext3 rootfs.img
# æ˜ å°„æ­¤æ–‡ä»¶åˆ°ä¸»æœºæ–‡ä»¶å¤¹
mount -o loop rootfs.img /mnt/temp
</code></pre>
<p>å¦‚æ­¤ä¾¿å¯é€šè¿‡æ‹·è´æ–‡ä»¶åˆ°<code>/mnt/temp/</code>ç›®å½•ï¼Œç­‰åŒäºæ‹·è´æ–‡ä»¶åˆ°rootfs.imgç¡¬ç›˜æ–‡ä»¶ã€‚è¿™é‡Œå¯ä»¥ç›´æ¥é€šè¿‡ä¸»æœºçš„æ–‡ä»¶ç›®å½•ç»„ç»‡å»æ„å»ºè·Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ç›´æ¥å®‰è£…ä¸€ä¸ªlinuxåˆ°æ­¤ç›®å½•ã€‚</p>
<p>ä½¿ç”¨æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç›´æ¥ä½¿ç”¨ç°æˆçš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚åœ¨UMLç½‘ç«™ <a class="link" href="http://user-mode-linux.sourceforge.net/"  target="_blank" rel="noopener"
    >The User-mode Linux Kernel Home Page</a> æœ‰ç›¸å…³é“¾æ¥å¯ä»¥ä¸‹è½½ï¼Œæ¯”å¦‚ä¸‹è½½ DSL-4.4-root_fs.bz2 æ–‡ä»¶ï¼Œé¦–å…ˆè§£å‹è¿è¡Œä¹‹ï¼š</p>
<pre><code>bunzip2 DSL-4.4-root_fs.bz2
./linux ubda=DSL-4.4-root_fs

#ç™»å½•ä¹‹åå‡ºç°rootæç¤ºç¬¦
root@console[/]#
#å…³é—­UML
root@console[/]# shutdown -h 0
</code></pre>
<p>è‡³äºæ ¹æ–‡ä»¶ç³»ç»Ÿéœ€è¦æ…¢æ…¢ç§¯ç´¯ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•è°ƒè¯•å†…æ ¸ï¼Œç”±å®˜æ–¹æ–‡æ¡£ <a class="link" href="http://user-mode-linux.sourceforge.net/hacking.html"  target="_blank" rel="noopener"
    >Kernel Hacking with UML</a> æ‰€è¨€ï¼Œç›´æ¥ä½¿ç”¨ gdb linux ä¾¿å¯è°ƒè¯•ï¼Œä¸è¿‡æˆ‘åœ¨å¯åŠ¨ä¸€å¼€å§‹ä¾¿é‡åˆ°æ®µé”™è¯¯ï¼Œå•æ­¥è¿è¡Œå±…ç„¶è¿˜èƒ½ç»§ç»­ï¼Œä¹‹åä¾¿é™·å…¥æ— ä¼‘æ­¢çš„trapä¸­ã€‚</p>
<p>ç»§ç»­ googleï¼ˆæœ€èƒ½æ‰¾åˆ°ç­”æ¡ˆçš„å¾€å¾€åœ¨å›½å¤–çš„è®ºå›ï¼Œè€Œä¸”å¸¸å¸¸éœ€è¦ç¿»å¢™ï¼‰ï¼Œæœ€åæ‰¾åˆ°ä¸¤ä¸ªè®¾ç½®ï¼Œæ˜¯SIGSEGVå’ŒSIGUSR1ä¿¡å·ä¸ä¸­æ–­ç»§ç»­è¿è¡Œï¼Œæœ€ç»ˆå±…ç„¶å¯ä»¥ï¼Œè¿™ç‚¹è®©äººç™¾æ€ä¸å¾—å…¶è§£ï¼Œè¿˜æ˜¯å…ˆçœ‹çœ‹ç°è±¡å¦‚ä½•ï¼š</p>
<pre><code>$ gdb linux
(gdb) br start_kernel
Breakpoint 1 at 0x80493bb: file init/main.c, line 533.
(gdb) handle SIGSEGV pass nostop noprint
Signal        Stop      Print   Pass to program Description
SIGSEGV       No        No      Yes             Segmentation fault
(gdb) handle SIGUSR1 pass nostop noprint
Signal        Stop      Print   Pass to program Description
SIGUSR1       No        No      Yes             User defined signal 1
(gdb) r ubda=DSL-4.4-root_fs
Starting program: /home/cpp/fox/kernel/linux-2.6.34/linux ubda=DSL-4.4-root_fs
Locating the bottom of the address space ... 0x1000
Locating the top of the address space ... 0xc0000000
Core dump limits :
        soft - 0
        hard - NONE
Checking that ptrace can change system call numbers...OK
Checking syscall emulation patch for ptrace...OK
Checking advanced syscall emulation patch for ptrace...OK
Checking for tmpfs mount on /dev/shm...OK
Checking PROT_EXEC mmap in /dev/shm/...OK
Checking for the skas3 patch in the host:
  - /proc/mm...not found: No such file or directory
  - PTRACE_FAULTINFO...not found
  - PTRACE_LDT...not found
UML running in SKAS0 mode

Breakpoint 1, start_kernel () at init/main.c:533
533             smp_setup_prhandleocessor_id();
(gdb)

# æ³¨é‡Šï¼Œgdb å¯åŠ¨å‚æ•°çš„è®¾ç½®
(gdb) r arg1 arg2 ...
(gdb) set args arg1 arg2 ...
# handle æŒ‡å®šå¦‚ä½•å¤„ç†ä¸€ä¸ªä¿¡å·ï¼Œè¯¦å°½çš„è§£é‡Šå¯æŸ¥é˜…å¸®åŠ©
(gdb) help handle
</code></pre>
<p>å±…ç„¶ä¸€åˆ‡é¡ºåˆ©çš„æ–­åˆ°äº†start_kernelï¼Œå“ˆå“ˆï¼Œä¸ç®¡å¦‚ä½•ï¼Œæ€»ç®—èƒ½å¤Ÿè°ƒè¯•å†…æ ¸äº†ã€‚æ¥ä¸‹æ¥è¿˜æœ‰UMLè™šæ‹Ÿæœºçš„ç½‘ç»œé…ç½®ï¼ŒUMLä½¿ç”¨äº†ä¸€ä¸ªå–å·§çš„æ–¹å¼å°±æ˜¯åˆ©ç”¨ tun å’Œ iptables ï¼Œå¥½åœ¨æˆ‘ä¹Ÿç ”ç©¶äº†å¤§åŠå¹´ï¼Œæ˜å¤©ç»§ç»­ã€‚</p>
<p>å¦å¤–æœ‰ä¸ªGDBè°ƒè¯•çš„é—®é¢˜ï¼Œæ˜æ˜é‡åˆ°äº†SIGSEGï¼Œä¸ºä»€ä¹ˆè¿˜èƒ½ç»§ç»­å‘¢ï¼Ÿè«éè¿™ä¸ªä¿¡å·æ˜¯è‡ªå·±å‘å‡ºçš„ï¼Ÿè¿˜æœ‰ä¹‹åçš„SEGTRAPä¿¡å·æ˜¯æ€ä¹ˆå‘å‡ºæ¥çš„ï¼Ÿè¦å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ–è®¸è¿˜å¾—æŸ¥é˜…UMLä»£ç ã€‚</p>
<h1 id="umlç½‘ç»œé…ç½®">UMLç½‘ç»œé…ç½®
</h1><p>UMLæ”¯æŒå¤šç§æ–¹å¼çš„ç½‘ç»œï¼Œä¸€èˆ¬ä½¿ç”¨tap/tunæ¨¡æ‹ŸUMLè™šæ‹Ÿæœºä¸­çš„eth0é©±åŠ¨ï¼Œä»…ä»…è¿™ç§æ–¹å¼ä¹Ÿèƒ½åˆ†ä¸ºæ¡¥æ¥å’ŒNATç­‰ç­‰ï¼Œæ‰‹å·¥é…ç½®ç½‘ç»œä¹Ÿæœ‰åŠ©äºç†è§£ç½‘ç»œçš„è¿è¡Œæ–¹å¼ã€‚</p>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ <a class="link" href="http://user-mode-linux.sourceforge.net/network.html"  target="_blank" rel="noopener"
    >Simple UML Networking</a> ä¸‹è½½ <code>uml_utilities</code> ï¼Œå…¶å®ä¹Ÿå°±ä½¿ç”¨äº†ä¸€ä¸ªå·¥å…· tunctlï¼Œè¿™ä¸ªå·¥å…·å¾ˆç®€å•ï¼Œå°±æ˜¯å¯åŠ¨ tun é©±åŠ¨ï¼Œé¦–å…ˆå¾—å…ˆæŸ¥çœ‹æ˜¯å¦åŠ è½½ tun é©±åŠ¨ï¼Œå½“ç„¶é¦–å…ˆéœ€è¦æœ‰rootæƒé™ï¼š</p>
<pre><code># æŸ¥çœ‹ç”¨æˆ· ID ï¼ˆtunctl ä½¿ç”¨ï¼‰
[cpp@dark tunctl]$ id
uid=500(cpp) gid=500(cpp) groups=500(cpp) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

# åˆ‡æ¢ç®¡ç†å‘˜æƒé™
[cpp@dark tunctl]$ su
Password:

# æŸ¥çœ‹tuné©±åŠ¨æ˜¯å¦åŠ è½½
[root@dark tunctl]# lsmod | grep tun

# æ²¡æœ‰åˆ™åŠ è½½tuné©±åŠ¨
[root@dark tunctl]# modprobe tun

# å†æ¬¡æŸ¥çœ‹
[root@dark tunctl]# lsmod | grep tun
tun                    13014  0

# æŸ¥çœ‹æ™®é€šç”¨æˆ·æ˜¯å¦æœ‰è¯»å†™tunè®¾å¤‡æƒé™
[root@dark tunctl]# ls /dev/net/tun -l
crw-rw-rw-. 1 root root 10, 200 Dec  8 11:19 /dev/net/tun

# å¯åŠ¨tunï¼Œè®¾ç½®ç”¨æˆ·ID
# éšåé©±åŠ¨ä»¥tapæ¨¡å¼å¯åŠ¨ï¼Œè®¾å¤‡ä¸º tap0
[root@dark tunctl]# ./tunctl -u 500
Set 'tap0' persistent and owned by uid 500

# æŸ¥çœ‹æ‰€æœ‰ç½‘å¡çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æœ‰tap0æ¥å£
[root@dark tunctl]#ifconfig -a
eth1      Link encap:Ethernet  HWaddr 08:00:27:54:D1:F5
          inet addr:10.33.33.34  Bcast:10.255.255.255  Mask:255.0.0.0
          inet6 addr: fe80::a00:27ff:fe54:d1f5/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:555523 errors:13 dropped:0 overruns:0 frame:0
          TX packets:70630 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:424000963 (404.3 MiB)  TX bytes:4827144 (4.6 MiB)
          Interrupt:19 Base address:0xd020

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:102 errors:0 dropped:0 overruns:0 frame:0
          TX packets:102 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:13444 (13.1 KiB)  TX bytes:13444 (13.1 KiB)

tap0      Link encap:Ethernet  HWaddr DA:47:96:23:59:AA
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:500
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

# æ¿€æ´»tapç½‘å¡å¹¶è®¾ç½®IPåœ°å€
[root@dark cpp]# ifconfig tap0 192.168.33.33 up

# å®Œæ¯•ååˆ é™¤ç½‘å¡å¯ä½¿ç”¨å‘½ä»¤
[root@dark tunctl]# ./tunctl -d tap0

åˆ°è¿™é‡Œå·²ç»è®¾ç½®å¥½tun/tapç½‘å¡ï¼Œæ¥ä¸‹æ¥å¯åŠ¨UMLè™šæ‹Ÿæœºå¹¶ä¸”é…ç½®ç½‘ç»œï¼š

# å¯åŠ¨UMLè™šæ‹Ÿæœºï¼Œè®¾ç½®ç½‘å¡ä¸ºtap
[cpp@dark linux-2.6.36]$ ./linux eth0=tuntap,tap0 ubda=Gentoo-10.0-AMD64-root_fs

# å¯åŠ¨è¿‡ç¨‹ä¸­å‡ºç°
eth0: broadcasting for a lease
eth0: timed out
# è¯´æ˜å¹¶æ²¡æœ‰è¿é€šç½‘ç»œ

# å¯åŠ¨è™šæ‹Ÿæœºåæ£€æµ‹ç½‘å¡é…ç½®
eth0: broadcasting for a lease
eth0: timed out
eth0: trying to use old lease in `/var/lib/dhcpcd/dhcpcd-eth0.lease'
localhost ~ # ifconfig
eth0      Link encap:Ethernet  HWaddr b2:9d:a5:12:b9:45
          inet addr:169.254.186.160  Bcast:169.254.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:9 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:1578 (1.5 KiB)
          Interrupt:5

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
</code></pre>
<p>å¯ä»¥çœ‹åˆ°UMLè™šæ‹Ÿæœºå·²ç»æœ‰ç½‘å¡é…ç½®ï¼Œä½†æ˜¯å¹¶æ— æ³•è¿é€šç½‘ç»œã€‚è¿é€šç½‘ç»œæœ‰å‡ ç§æ–¹å¼ï¼Œåƒvirtualboxç­‰è™šæ‹Ÿæœºçš„NATå’Œæ¡¥æ¥ç­‰ç­‰ï¼ŒæŒ‰ç…§UMLè¿™ç§è®¾è®¡æ–¹å¼ï¼Œåº”è¯¥å¯ä»¥é…ç½®å‡ºæ¥ä»»æ„ç±»å‹ï¼Œè¿™é‡Œå°è¯•é…ç½®æ¡¥æ¥æ¨¡å¼ï¼š</p>
<pre><code># è®¾ç½®IPè·¯ç”±è½¬å‘
[root@dark linux-2.6.36]# echo 1 &gt; /proc/sys/net/ipv4/ip_forward
[root@dark linux-2.6.36]# echo 1 &gt; /proc/sys/net/ipv4/conf/tap0/proxy_arp

# åˆ›å»ºç½‘æ¡¥ ï¼ˆbrctl ä½äº bridge-utils è½¯ä»¶åŒ…ï¼‰
[root@dark linux-2.6.36]# brctl addbr br0
# æŠŠ eth1 å’Œ tap0 åŠ å…¥ç½‘æ¡¥
[root@dark linux-2.6.36]# brctl addif br0 eth1
[root@dark linux-2.6.36]# brctl addif br0 tap0

# ä¿®æ”¹br0ç½‘æ¡¥çš„ç½‘ç»œé…ç½®å¹¶æ¿€æ´»
[root@dark linux-2.6.36]# ifconfig eth1 10.33.33.35 up
[root@dark linux-2.6.36]# ifconfig tap0 10.33.33.36 up
[root@dark linux-2.6.36]# ifconfig br0 10.33.33.34 up

# å¯åŠ¨UMLè™šæ‹Ÿæœºï¼Œè®¾ç½®ç½‘å¡ä¸ºtap
[cpp@dark linux-2.6.36]$ ./linux eth0=tuntap,tap0 ubda=Gentoo-10.0-AMD64-root_fs

# è®¾ç½®UMLè™šæ‹Ÿæœºç½‘ç»œé…ç½®
localhost ~ # ifconfig eth0 10.33.33.36 netmask 255.255.255.0
</code></pre>
<p>ç»è¿‡è®¾ç½®ç½‘æ¡¥åå‘ç°ä»ç„¶æ— æ³•è¿é€šæœ¬åœ°10.33.33.35ï¼Œå´å¯ä»¥pingé€šè¿œç¨‹æœºå™¨åœ°å€ï¼ŒçœŸæ˜¯æŠ“ç‹‚ï¼ŒæŠ“åŒ…å‘ç°tap0ç½‘å¡arpè§£ ææœ‰é—®é¢˜ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹å‘ç°tap0ç½‘å¡çš„macåœ°å€ä¸è™šæ‹Ÿæœºå†…eth0ç½‘å¡macåœ°å€ä¸åŒï¼Œä¹Ÿå°±æ˜¯UMLå†…éƒ¨é‡æ–°åˆ›å»ºä¸€ä¸ªç½‘å¡è€Œå¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨tap0ï¼Œ åªæ˜¯é€šè¿‡tap0æ”¶å‘æ•°æ®ï¼Œä½†ä¸ºä»€ä¹ˆè¿œç¨‹æœºå™¨å¯ä»¥æ¥å—ä½†æ˜¯æœ¬åœ°åœ°å€æ— æ³•æ¥å—å‘¢ï¼Ÿæœ¬åœ°ç½‘å¡æŠŠ10.33.33.36å½“æˆäº†æœ¬æœºtap0ï¼Œè€Œå¤–ç½‘åœ°å€æŠŠ 10.33.33.36å½“æˆäº†UMLè™šæ‹Ÿæœºï¼Œæ•…èƒ½è¿é€šï¼Œä¹Ÿå°±æ˜¯UMLè™šæ‹Ÿæœºè·Ÿä¸»æœºtap0å¹¶ä¸ç›¸åŒï¼Œæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æœºå™¨ï¼ŒæŠŠUMLè™šæ‹Ÿæœºè®¾ç½®ä¸º 10.33.33.37ï¼Œå‘ç°æ‰€æœ‰æœºå™¨éƒ½å¯ä»¥è¿é€šã€‚è¿™æ ·å°±æŠŠUMLè™šæ‹Ÿæœºæ¡¥æ¥åˆ°ç½‘ç»œä¸Šäº†ã€‚</p>
<p>ç°åœ¨è®¾ç½®NATç½‘ç»œï¼ŒæŠŠç³»ç»Ÿç½‘ç»œçŠ¶æ€æ¢å¤åˆ°å¼€å§‹ï¼Œ é‡æ–°è®¾ç½®tapé©±åŠ¨ï¼Œåœ°å€ä¸º192.168.33.33ï¼Œå¯åŠ¨è™šæ‹Ÿæœºï¼Œè®¾ç½®ipåœ°å€ä¸º 192.168.33.34ï¼Œè¿™æ · 192.168.33.* å°±ç›¸å½“äºä¸€ä¸ªå°å±€åŸŸç½‘ï¼Œ192.168.33.34 é€šè¿‡ 192.168.33.33 è½¬å‘ï¼Œè®¾ç½®å®Œæ¯•ä»¥åäºŒè€…ä¾¿å¯é€šä¿¡ï¼Œä¹Ÿçœå»äº†æ¡¥æ¥çš„éº»çƒ¦ï¼Œåªæ˜¯éœ€è¦æ“çºµ iptablesã€‚</p>
<pre><code># åœ¨ UML è™šæ‹Ÿæœºå†…è®¾ç½®é»˜è®¤è·¯ç”±
localhost ~ # route add -net 0.0.0.0 netmask 0.0.0.0 gw 192.168.33.33
# æŸ¥çœ‹è·¯ç”±è¡¨ï¼Œçœ‹åˆ°å·²ç»æ·»åŠ äº† default ç½‘å…³ä¸º 192.168.33.33
localhost ~ # route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.33.0    *               255.255.255.0   U     0      0        0 eth0
loopback        *               255.0.0.0       U     0      0        0 lo
default         192.168.33.33   0.0.0.0         UG    0      0        0 eth0

# è®¾ç½®IPè·¯ç”±è½¬å‘
[root@dark linux-2.6.36]# echo 1 &gt; /proc/sys/net/ipv4/ip_forward

# è®¾ç½®SNATæºåœ°å€è½¬æ¢ 10.33.33.34 ä¸ºeth1åœ°å€
[root@dark linux-2.6.36]# iptables -t nat -A POSTROUTING -o eth1 -j SNAT --to-source 10.33.33.34

# å¦‚æœæ­¤æ—¶ä¸é€šï¼Œå¯æ£€æŸ¥iptablesçš„å…¶ä»–è§„åˆ™å’ŒUMLä¸ä¸»æœºçš„è·¯ç”±è¡¨é…ç½®
</code></pre>
<p>è¿™æ ·ä¾¿å¯åšæˆNATçš„æ•ˆæœï¼Œæ¯”æ¡¥æ¥æ–¹å¼ç®€å•çš„å¤šï¼Œåªæ˜¯éœ€è¦çŸ¥é“iptablesçš„ç”¨æ³•ã€‚å½“ç„¶ä»¥ä¸Šé…ç½®æ¯æ¬¡é‡å¯å°†ä¼šæ¶ˆå¤±ï¼Œå¯ä»¥å†™åˆ°é…ç½®å¼€æœºè‡ªåŠ¨è®¾ç½®ã€‚</p>
<h1 id="qemuè°ƒè¯•linuxå†…æ ¸">Qemuè°ƒè¯•Linuxå†…æ ¸
</h1><p>é€šè¿‡UMLå¯ä»¥æ–¹ä¾¿çš„åœ¨æœ¬æœºè°ƒè¯•Linuxå†…æ ¸ï¼ŒUMLæ˜¯ä¸€ç§ç‰¹æ®Šçš„è™šæ‹Ÿæœºï¼Œå¦å¤–ä¸€ç§æ›´ä¸ºçµæ´»çš„è™šæ‹Ÿæœºæ˜¯Qemuï¼ŒQemuæ˜¯ä¸€ç§å®Œå…¨ä»¿çœŸè™šæ‹Ÿæœºï¼Œ å¯ä»¥åœ¨i386å¹³å°ä»¿çœŸä»»æ„å…¶ä»–å¤„ç†å™¨æ„æ¶ï¼Œè€Œä¸”æ”¯æŒGDBè°ƒè¯•ï¼Œè¿™é‡Œå°è¯•ä¸€ä¸‹ä½¿ç”¨Qemuè°ƒè¯•Linuxå†…æ ¸ï¼ŒQemuå‚æ•°-kernelå¯ä»¥ç›´æ¥æŒ‡å®š å†…æ ¸å¯åŠ¨ï¼Œè¿™ä¸UMLæœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚</p>
<p>é¦–å…ˆéœ€è¦ç¼–è¯‘å®‰è£…Qemuï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆç–‘æƒ‘ä¹‹å¤„ï¼Œç›´æ¥ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½æºç ï¼Œä½¿ç”¨Linuxæœ€å¸¸ç”¨çš„ç¼–è¯‘å‘½ä»¤å³å¯ï¼š</p>
<pre><code># é»˜è®¤é€‰é¡¹ä¼šç¼–è¯‘æ‰€æœ‰å¤„ç†å™¨æ„æ¶è™šæ‹Ÿæœº
# å¯ä»¥ ./configure --help æŸ¥çœ‹ç¼–è¯‘ç‰¹å®šå¹³å°çš„é…ç½®

cpp@dark:~/qemu-0.12.4$ ./configure --target-list=i386-softmmu
cpp@dark:~/qemu-0.12.4$ make
cpp@dark:~/qemu-0.12.4$ make install
</code></pre>
<p>æ¥ä¸‹æ¥ä»¥é»˜è®¤é€‰é¡¹ç¼–è¯‘å†…æ ¸ï¼Œä¸è¿‡å·¨å´©æºƒçš„æ˜¯å†…æ ¸é»˜è®¤æ²¡æœ‰DEBUG_INFOé€‰é¡¹ï¼Œæ‰€ä»¥è™½ç„¶èƒ½åœ¨å¯¼å‡ºç¬¦å·éƒ¨åˆ†æ–­ä¸‹æ¥ï¼Œä½†æ˜¯æ²¡æœ‰æºç ï¼Œæ‰€ä»¥éœ€è¦é€‰åˆ™Compile the kernel with debug infoé€‰é¡¹ã€‚</p>
<pre><code># é»˜è®¤é€‰é¡¹
cpp@dark:~/linux-2.6.34$ make defconfig
# é…ç½®èœå•ï¼Œé€‰æ‹©è°ƒè¯•ä¿¡æ¯
cpp@dark:~/linux-2.6.34$ make menuconfig
# ç¼–è¯‘å†…æ ¸
cpp@dark:~/linux-2.6.34$ make
</code></pre>
<p>ç„¶åä½¿ç”¨QemuåŠ è½½å†…æ ¸å¯åŠ¨</p>
<pre><code>cpp@dark:~/linux-2.6.34$ qemu -s -S -kernel arch/x86/boot/bzImage -hda rootfs.img -append &quot;root=/dev/sda&quot;
# å…¶ä¸­ä¸€äº›é€‰é¡¹çš„è§£é‡Šå¦‚ä¸‹
# -s ç›‘å¬tcp:1234ç«¯å£ä»¥ç­‰å¾…GDBè¿æ¥
# -S è™šæ‹Ÿæœºå¯åŠ¨ååœæ­¢ï¼Œä»¥ä¾¿GDBè¿æ¥åè°ƒè¯•å¯åŠ¨è¿‡ç¨‹
# -kernel å‹ç¼©å†…æ ¸
# -hda ç¡¬ç›˜
# -appand å¯åŠ¨å‚æ•°
</code></pre>
<p>è¿™é‡Œç³»ç»Ÿå¾ˆå®¹æ˜“å¯åŠ¨ä¸äº†ï¼Œå¦‚æœç³»ç»Ÿç”±äºVFSåŠ è½½é”™è¯¯æ— æ³•å¯åŠ¨ï¼Œé¦–å…ˆå°è¯•å¯åŠ¨å‚æ•°root=/dev/sdaä¸ºroot=/dev /hdaï¼Œhdaæ˜¯IDEç¡¬ç›˜æ ‡è¯†ï¼Œsdaä¸ºSCSIç¡¬ç›˜ï¼Œè¿™è¦çœ‹å†…æ ¸è¯†åˆ«æˆå“ªç§ï¼Œå¦‚æœä»ç„¶ä¸è¡Œï¼Œé‚£è¦æ£€æµ‹rootfs.imgæ ¹æ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼è·Ÿå†…æ ¸æ‰€ æ”¯æŒçš„æ ¼å¼æ˜¯å¦åŒ¹é…ï¼Œ2.6.34æ”¯æŒext3æ ¼å¼ï¼Œå¦‚æœæ ¼å¼é”™è¯¯ï¼Œå¯ä»¥åˆ©ç”¨ Linux å†…æ ¸è°ƒè¯•1 é‡Œçš„æ–¹æ³•ï¼Œè‡ªå·±æ‰‹å·¥åˆ›å»ºä¸€ä¸ªext3æ ¼å¼çš„æ–‡ä»¶ï¼Œç„¶åmountåˆ°ä¸´æ—¶æ–‡ä»¶ï¼ŒæŠŠå…¶ä»–æ ¹æ–‡ä»¶ç³»ç»Ÿå…¨éƒ¨æ‹·è´è¿›å»å³å¯ã€‚</p>
<p>è¿™ æ ·å¯åŠ¨Qemuä¹‹åï¼Œå‘ç°ç³»ç»Ÿä¸€ç‰‡é»‘å±ï¼Œè¿™é‡Œå› ä¸ºQemuå¯åŠ¨å‚æ•°è¢«è®¾ç½®ä¸ºç¦æ­¢ï¼ŒQemuæœ¬èº«å…·æœ‰æ˜¾ç¤ºçª—å£å’Œæ§åˆ¶çª—å£ï¼Œåˆ©ç”¨ Ctrl+Alt+2 è¿›å…¥æ§åˆ¶å°ï¼Œcå‘½ä»¤ç»§ç»­è™šæ‹Ÿæœºï¼ŒCtrl+Alt+1 è¿”å›æ˜¾ç¤ºçª—å£ï¼ŒQemuçš„æ§åˆ¶å°å¯ä»¥æ§åˆ¶å¾ˆå¤šé€‰é¡¹ï¼Œä»è¿™ç‚¹æ¥çœ‹è¦æ¯”VMwareç­‰è¦çµæ´»ä¸€äº›ï¼ŒUMLæœ¬èº«ä¹Ÿæ”¯æŒè¿è¡Œæ—¶æ§åˆ¶ã€‚</p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨GDBå¯åŠ¨è™šæ‹Ÿæœºï¼Œå½“ç³»ç»Ÿåœæ­¢åœ¨å¯åŠ¨ä¹‹åæ—¶ï¼Œç”¨GDBåŠ è½½ï¼š</p>
<pre><code># å¯åŠ¨GDBï¼ŒGDBåŠ è½½æœªå‹ç¼©å†…æ ¸
cpp@dark:~/linux-2.6.34$ gdb vmlinux
GNU gdb 6.8
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later 
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;i486-slackware-linux&quot;...
(gdb)

# è®¾ç½®æ–­ç‚¹
(gdb) br start_kernel
Breakpoint 1 at 0xc172f5d4: file init/main.c, line 533.

# è¿æ¥Qemuç›‘å¬ç«¯å£1234
(gdb) target remote localhost:1234
Remote debugging using localhost:1234
[New Thread 1]
0x0000fff0 in ?? ()

# ç»§ç»­Qemuè™šæ‹Ÿæœºæ‰§è¡Œ
(gdb) c
Continuing.

# å†…æ ¸è§£å‹ä¹‹åå¾ˆå¿«ä¾¿åˆ°è¾¾æ–­ç‚¹
Breakpoint 1, start_kernel () at init/main.c:533
533             smp_setup_processor_id();
(gdb)

# æ¥ä¸‹æ¥ä¾¿å¯ä»»æ„è°ƒè¯•å†…æ ¸
(gdb) list
528     asmlinkage void __init start_kernel(void)
529     {
530             char * command_line;
531             extern struct kernel_param __start___param[], __stop___param[];
532
533             smp_setup_processor_id();
534
535             /*
536              * Need to run as early as possible, to initialize the
537              * lockdep hash:
(gdb)
</code></pre>
<p>Qemuç”±äºæ˜¯å®Œå…¨ä»¿çœŸå®ç°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä»»æ„å¹³å°è°ƒè¯•å…¶ä»–æ„æ¶å†…æ ¸ï¼Œç†è®ºä¸Šç”šè‡³å¯ä»¥åœ¨Windowså¹³å°äº¤å‰ç¼–è¯‘Linuxå†…æ ¸ï¼Œå†å»ç”±QemuåŠ è½½è°ƒè¯•ï¼ˆäº¤å‰ç¼–è¯‘æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦å…ˆç¼–è¯‘ç›®æ ‡æ„æ¶çš„binutilï¼Œè€Œåé“¾æ¥å†…æ ¸ï¼‰ã€‚</p>
<h1 id="umlå’Œqemuè°ƒè¯•å†…æ ¸æ¨¡å—">UMLå’ŒQemuè°ƒè¯•å†…æ ¸æ¨¡å—
</h1><p>è¿™æ¬¡æ¥çœ‹å¦‚ä½•è°ƒè¯•å†…æ ¸æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯é©±åŠ¨ç¨‹åºï¼Œæ¨¡å—çš„è°ƒè¯•è·Ÿæ™®é€šç¨‹åºç•¥æœ‰ä¸åŒï¼Œä¸è®ºæ˜¯å†…æ ¸è¿˜æ˜¯æ™®é€šåº”ç”¨ç¨‹åºï¼Œåœ¨è¿æ¥ä¹‹åä¾¿ä»¥å¾—çŸ¥ä»£ç å°†è¦åŠ è½½çš„ä½ç½®ï¼Œç”¨æˆ·æ€ç¨‹åºæœ‰è™šæ‹Ÿåœ°å€æ˜ å°„æœºåˆ¶ï¼Œè€Œå†…æ ¸ç‹¬å ç‰©ç†å†…å­˜ã€‚å†…æ ¸è¿è¡Œä¸å…±äº«çš„å†…æ ¸åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„çº¿æ€§åœ°å€ï¼Œåªèƒ½ç”±å†…æ ¸åŠ è½½æ¨¡å—æ—¶æŒ‡å®šèµ·å§‹åœ°å€ï¼Œæ¨¡å—ä¸­éƒ½ä»¥æ­¤ä¸ºåç§»è¿è¡Œã€‚æ‰€ä»¥å†…æ ¸çš„è°ƒè¯•ä¸èƒ½ä½¿ç”¨æ™®é€šçš„æ–¹å¼ï¼Œéœ€è¦çŸ¥é“æ¨¡å—çš„åŠ è½½åœ°å€ã€‚</p>
<p>è€Œä¸”Qemuçš„è°ƒè¯•åŸç†ä¸UMLç›¸ä¼¼ï¼Œä¹Ÿå¯ç”¨ç›¸åŒçš„æ–¹æ³•è¿›è¡Œæ¨¡å—çš„è°ƒè¯•ï¼Œè¿™é‡Œä»…ä»¥UMLæ¨¡å—è°ƒè¯•ä¸¾ä¾‹</p>
<p>é¦–å…ˆéœ€è¦å®Œæˆä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œè¿™é‡Œå¯ä»¥ç…§æ¬ä¹‹å‰çš„ Linux å†…æ ¸è°ƒè¯• ï¼Œä¿å­˜æºæ–‡ä»¶ä¸ºgo.cï¼Œå®ŒæˆMakefileå’Œç¼–è¯‘å·¥ä½œï¼Œå†…æ ¸æºç ä»¥ç¼–è¯‘UMLçš„å†…æ ¸ä¸ºå‡†ï¼š</p>
<pre><code># Makefile å†…å®¹
obj-m := go.o

# ç¼–è¯‘å‘½ä»¤
[cpp@dark go]$ make -C /home/cpp/fox/linux-2.6.36 M=$PWD modules ARCH=um

æ¥ä¸‹æ¥å¯åŠ¨å¸¦ç½‘ç»œçš„UMLï¼Œæ‹·è´go.koæ¨¡å—æ–‡ä»¶åˆ°UMLè™šæ‹Ÿæœºä¸­ï¼Œä¹‹åå¯åŠ¨GDBï¼š

# æŸ¥çœ‹ linux è¿›ç¨‹ ID
[cpp@dark linux-2.6.36]$ ps -A | grep linux
 7333 pts/0    00:00:38 linux
 7340 pts/0    00:00:00 linux
 7341 pts/0    00:00:00 linux
 7342 pts/0    00:00:00 linux
 7343 pts/0    00:00:00 linux
 7481 pts/0    00:00:00 linux
 7546 pts/0    00:00:00 linux
 9864 pts/0    00:00:00 linux
 9866 pts/0    00:00:00 linux
 9868 pts/0    00:00:00 linux

# å¯åŠ¨ GDB
[cpp@dark linux-2.6.36]$ gdb linux
GNU gdb (GDB) Fedora (7.1-18.fc13)
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-redhat-linux-gnu&quot;.
For bug reporting instructions, please see:...
Reading symbols from /home/cpp/fox/linux-2.6.36/linux...done.

# attach åˆ° linux è¿›ç¨‹ï¼Œattachç¬¬ä¸€ä¸ªè¿›ç¨‹
(gdb) attach 7333

# å¿½ç•¥æ®µé”™è¯¯
(gdb) handle SIGSEGV pass nostop noprint

# å¯¹ sys_init_module è®¾ç½®æ–­ç‚¹ï¼Œæˆªè·æ¨¡å—åŠ è½½äº‹ä»¶
(gdb) br sys_init_module
Breakpoint 1 at 0x60052421: file kernel/module.c, line 2696.

# ç»§ç»­æ‰§è¡Œ
(gdb) c
Continuing.

# åœ¨è™šæ‹Ÿæœºä¸­åŠ è½½ go.ko æ¨¡å—
localhost ~ # insmod go.ko

# ä¸»æœºGDBæˆªè·æ–­ç‚¹
Breakpoint 1, sys_init_module (umod=0x603030, len=124282,
    uargs=0x603010) at kernel/module.c:2696
2696 if (!capable(CAP_SYS_MODULE) || modules_disabled)
(gdb)
# æ¨¡å—åŠ è½½ load_module è°ƒç”¨ç»“æœ
(gdb) n 2691 {
(gdb) n 2696 if (!capable(CAP_SYS_MODULE) || modules_disabled)
(gdb) n 2700 mod = load_module(umod, len, uargs);
(gdb) n 2701 if (IS_ERR(mod))
(gdb) print mod
$1 = (struct module *) 0x628482b0

# ä» include/linux/module.h æŸ¥çœ‹ module.hç»“æ„
# struct module_sect_attrs *sect_attrs; ä¸ºæ¨¡å—çš„æ®µå±æ€§
# æŸ¥çœ‹æ¨¡å—å
(gdb) print mod-&gt;name
$2 = &quot;go&quot;, '\000'
# æŸ¥çœ‹æ¨¡å—æ®µä¸ªæ•°
(gdb) print mod-&gt;sect_attrs-&gt;nsections
$3 = 11
# æŸ¥çœ‹ç¬¬ä¸€ä¸ªæ®µå
(gdb) print mod-&gt;sect_attrs-&gt;attrs[0]-&gt;name
$4 = 0x61daa3a0 &quot;.note.gnu.build-id&quot;
# æ‰¾åˆ° .text æ®µï¼Œå¹¶æ˜¾ç¤ºåŸºå€
(gdb) print mod-&gt;sect_attrs-&gt;attrs[1]-&gt;name
$5 = 0x61daa3c0 &quot;.text&quot;
(gdb) print /x mod-&gt;sect_attrs-&gt;attrs[1]-&gt;address
$6 = 0x62848000
# åŠ è½½ç¬¦å·ï¼Œä½¿ç”¨ GDB çš„ add-symbol-file å‘½ä»¤åŠ è½½æ¨¡å—ç¬¦å·åˆ°åŸºå€
(gdb) add-symbol-file go/go.ko 0x62848000 add symbol table from file &quot;go/go.ko&quot; at .text_addr = 0x62848000 (y or n) y Reading symbols from /home/cpp/fox/linux-2.6.36/go/go.ko...done.

# è®¾ç½®æ¨¡å—æ–­ç‚¹
(gdb) br simple_read Breakpoint 2 at 0x62848028: file /home/cpp/fox/linux-2.6.36/go/go.c, line 21.
# ç»§ç»­è¿è¡Œ
(gdb) c Continuing.

# UML è™šæ‹Ÿæœºä¸­æ“ä½œæ¨¡å— localhost ~
# cat /dev/simple

# ä¸»æœºæ–­ç‚¹ç”Ÿæ•ˆ Breakpoint 2, simple_read (pfile=0x61c74180, buf=0x60d000

, size=32768, ppos=0x61e0bec0) at /home/cpp/fox/linux-2.6.36/go/go.c:21 21 { (gdb) # æŸ¥çœ‹ä¿¡æ¯å¹¶è°ƒè¯• (gdb) n 22 if (copy_to_user(buf, â€œtest data\nâ€, 10)) (gdb)
</code></pre>
<p>å½“ç„¶åŠ è½½ç¬¦å·æ—¶è¿˜å¯ä»¥æŸ¥çœ‹ .data æ®µå’Œ .bss æ®µçš„åŸºå€ï¼ŒåŠ è½½go.koæ—¶åŒæ—¶å¯ä»¥è®¾ç½®äºŒè€…çš„åŸºå€ï¼Œä»¥ä¾¿å¯ä»¥è°ƒè¯•å…¨å±€å˜é‡ç­‰ç­‰ï¼Œåˆçœ‹èµ·æ¥è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå…¶å®å°±æ˜¯é€šè¿‡è°ƒè¯•å†…æ ¸åŠ è½½ä½ç½®æ¥ç¡®å®šæ¨¡å—æœ€ç»ˆå°†è¦åŠ è½½çš„åŸºå€ï¼Œè€Œåé€šè¿‡æœºåˆ¶åŠ è½½æ¨¡å—ç¬¦å·ã€‚</p>
<p>è¿™ä¸ªå¤æ‚çš„è¿‡ç¨‹å¦‚æœæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨å¤„ç†æ˜¯éå¸¸çƒ¦äººçš„ä¸€ä»¶äº‹ï¼Œå¥½åœ¨GDBæœ¬èº«æœ‰è„šæœ¬æ‰©å±•ï¼ˆç”šè‡³å¯æ‰§è¡ŒPythonè„šæœ¬ï¼‰ï¼Œæ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œè¿™é‡Œæ¥è¯•ç€å†™ä¸€ä¸ªç®€å•çš„æ‰“å°æ¨¡å—sectionåå­—å’ŒåŸºå€çš„è„šæœ¬ã€‚</p>
<p>GDBè„šæœ¬è¿è¡Œå¯ä»¥ç”±ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨GDBå¯åŠ¨æ—¶ï¼Œåœ¨å½“å‰ç›®å½•æŸ¥æ‰¾.gdbinitæ–‡ä»¶è§£é‡Šæ‰§è¡Œï¼Œå¦ä¸€ç§åœ¨GDBè¿è¡ŒæœŸé—´ä½¿ç”¨ source script-file å‘½ä»¤æ¥æ‰§è¡Œï¼Œè„šæœ¬çš„è¯´æ˜å¯æŸ¥é˜…æ–‡æ¡£ï¼Œä»¥ä¸‹æ˜¯ç®€å•çš„æ‰“å°æ®µä¿¡æ¯çš„è„šæœ¬ï¼š</p>
<pre><code>define modsec
        set $index = 0
        while $index &lt; mod-&gt;sect_attrs-&gt;nsections
                printf &quot;Name\t%s\tAddress\t0x%x\n&quot;, mod-&gt;sect_attrs-&gt;attrs[$index]-&gt;name, mod-&gt;sect_attrs-&gt;attrs[$index]-&gt;address
                set $index = $index + 1
        end
end
</code></pre>
<p>ä»¥ä¸‹æ˜¯åŠ è½½å¹¶æ‰§è¡Œè„šæœ¬æ•ˆæœï¼š</p>
<pre><code># åŠ è½½è„šæœ¬
(gdb) source modsec
(gdb) c
Continuing.

# åœ¨è™šæ‹Ÿæœºä¸­åŠ è½½ go.ko æ¨¡å—
# å¹¶å•æ­¥æ‰§è¡Œåˆ° mod = load_module(umod, len, uargs);
Breakpoint 1, sys_init_module (umod=0x603030, len=124282,
    uargs=0x603010) at kernel/module.c:2696
2696 if (!capable(CAP_SYS_MODULE) || modules_disabled)
(gdb) n
2691 {
(gdb) n
2696 if (!capable(CAP_SYS_MODULE) || modules_disabled)
(gdb) n
2700 mod = load_module(umod, len, uargs);
(gdb) n
2701 if (IS_ERR(mod))
# è°ƒç”¨å®šä¹‰å‘½ä»¤æ‰“å°æ®µ
(gdb) modsec
Name .note.gnu.build-id Address 0x6286f09c
Name .text Address 0x6286f000
Name .exit.text Address 0x6286f050
Name .init.text Address 0x62872000
Name .rodata.str1.1 Address 0x6286f0c0
Name .eh_frame Address 0x6286f118
Name .data Address 0x6286f1e0
Name .gnu.linkonce.this_module Address 0x6286f2b0
Name .bss Address 0x6286f490
Name .symtab Address 0x62872098
Name .strtab Address 0x628725c0
</code></pre>
<p>å¦‚æ­¤ä¾¿å¯ç¨å¾®æ–¹ä¾¿ä¸€ç‚¹çš„æ‰“å°æ‰€æœ‰æ®µåå’Œæ®µåŸºå€ï¼Œå¦‚æœæ·»åŠ å…¶ä»–è„šæœ¬æ‰©å±•ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿ä¸”é«˜æ•ˆçš„è°ƒè¯•Linuxå†…æ ¸ã€‚</p>
<h1 id="ä½¿ç”¨kgdbåŒæœºè°ƒè¯•">ä½¿ç”¨KGDBåŒæœºè°ƒè¯•
</h1><p>è™½ç„¶ä½¿ç”¨UMLæˆ–è€…Qemuå¯ä»¥è°ƒè¯•Linuxå†…æ ¸ï¼Œä½†UMLå’ŒQemuæ¯•ç«Ÿæ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿï¼Œè°ƒè¯•ç¡¬ä»¶é©±åŠ¨æ€»æ˜¯ç”¨è™šæ‹Ÿç¡¬ä»¶æ€»ä¸æˆäº‹ï¼Œè€Œä¸”Qemuæ®ä¼ é—» å¯¹äºæ—¶é’Ÿå’Œä¸­æ–­çš„å¤„ç†ä¹Ÿæœ‰é—®é¢˜ï¼Œæ‰€ä»¥å¯¹äºå¤„ç†çœŸå®ç¡¬ä»¶çš„é—®é¢˜ï¼Œæœ€å®Œç¾çš„è°ƒè¯•æ–¹å¼å°±æ˜¯åŒæœºè°ƒè¯•ï¼Œè¢«è°ƒè¯•å†…æ ¸åœ¨å®Œå…¨çœŸå®çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œæ’é™¤è™šæ‹Ÿæœºåˆ¶çš„ä¸ç¨³å®šå›  ç´ ï¼Œè€Œä¸”ä½¿ç”¨å†…æ ¸è‡ªå¸¦çš„KGDBæœºåˆ¶ï¼Œæ›´å…·æœ‰å¯é æ€§ï¼Œç±»ä¼¼Windowsä¸‹çš„WinDbgè°ƒè¯•æ–¹å¼ã€‚è¿™é‡Œä½¿ç”¨VirtualBoxè™šæ‹Ÿæœºè¿›è¡Œè°ƒè¯•ï¼Œä½†æ‰€æ åŠçš„æ–¹æ³•å®Œå…¨é€‚ç”¨äºè¯¸å¦‚VMWareã€Qemuè™šæ‹Ÿæœºæˆ–è€…çœŸå®æœºå™¨ï¼Œåªæ˜¯ç›¸å…³çš„ä¸²å£é…ç½®æ–¹å¼æœ‰äº›è®¸ä¸åŒè€Œå·²ã€‚</p>
<p>é¦–å…ˆéœ€è¦ç¼–è¯‘é…ç½®KGDBé€‰é¡¹çš„å†…æ ¸ï¼Œç¼–è¯‘æ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼š</p>
<pre><code># é…ç½®å†…æ ¸é€‰é¡¹
[cpp@dark linux-2.6.34]$ make menucofnig
# Kernel hacking  ---&gt;
# 		[*] Compile the kernel with debug info
# 		[*] KGDB: kernel debugging with remote gdb  ---&gt;

# ç¼–è¯‘
[cpp@dark linux-2.6.34]$ make
</code></pre>
<p>ç¼–è¯‘å®Œæˆä¹‹åéœ€è¦åœ¨ç›®æ ‡æœºå™¨éƒ¨ç½²è‡ªå·±çš„å†…æ ¸ï¼Œéœ€è¦ä¿®æ”¹grub.confï¼Œæˆ–è€…liloçš„é…ç½®ï¼Œè¿™å†³å®šäºLinuxä½¿ç”¨å“ªç§å¼•å¯¼ç¨‹åºï¼Œè¿™é‡Œä¿®æ”¹grub.confï¼Œé¦–å…ˆæ‹·è´ç¼–è¯‘å¥½æœªå‹ç¼©å†…æ ¸é•œåƒè‡³ç›®æ ‡æœºå™¨bootåˆ†åŒºï¼Œå‘½åä¸ºlinux-2.6.34ã€‚</p>
<pre><code># é…ç½®æ–‡ä»¶è·¯å¾„ /boot/grub/grub.conf
# é»˜è®¤å¯åŠ¨å†…æ ¸
default 0
# é€‰æ‹©è¶…æ—¶æ—¶é—´
timeout 30

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä»¥å¢åŠ ä¸€ä¸ªæ–°çš„å¯åŠ¨é¡¹
title Linux 2.6.34 (Debug)
root (hd0,0)
kernel /boot/linux-2.6.34 root=/dev/sdb
</code></pre>
<p>å¯¹äºliloï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶/etc/lilo.confï¼Œä¹‹åå¿…é¡»ä½¿ç”¨lilo -C /etc/lilo.confä½¿é…ç½®ç”Ÿæ•ˆã€‚</p>
<p>å¯ åŠ¨ç³»ç»Ÿåï¼Œé¦–å…ˆå‡ºç°grubå¼•å¯¼ç”»é¢ï¼Œé€‰æ‹©Debugå†…æ ¸å¯åŠ¨ï¼Œä¸è®ºçœŸæœºè¿˜æ˜¯è™šæ‹Ÿæœºï¼Œæ—¶å¸¸æœ‰ç³»ç»Ÿæ— æ³•å¯åŠ¨çš„é—®é¢˜ï¼Œæ˜¯å› ä¸ºå†…æ ¸é…ç½®è¿‡å°ï¼Œæœ€åŸºæœ¬çš„å¯åŠ¨éƒ½æ— æ³• æ”¯æŒï¼Œå¦‚æœå‡ºç°æ‰¾ä¸åˆ°sdb1ç±»ä¼¼é”™è¯¯ï¼Œéœ€è¦æ£€æŸ¥sdb1æ˜¯å¦æ­£ç¡®ï¼ŒIDE/ATAç¡¬ç›˜ä»¥hæ‰“å¤´ï¼Œä¸ºhdaç­‰ï¼ŒSATAå’ŒSCISä»¥sæ‰“å¤´ï¼Œä¸ºsdaç­‰ ç­‰ï¼Œåç¼€aï¼Œbåˆ†åˆ«ä¸ºç¬¬å‡ å—ç¡¬ç›˜ï¼Œsdaä¸ºç¬¬ä¸€å—ï¼Œsdbä¸ºç¬¬äºŒå—ï¼Œå…¶åçš„æ•°å­—1ã€2æŒ‡æ˜ç¬¬å‡ ä¸ªåˆ†åŒºï¼Œå¦å¤–éœ€è¦æ£€æŸ¥çš„æ˜¯ç¡¬ç›˜é©±åŠ¨æ˜¯å¦æ­£ç¡®å®‰è£…ï¼Œè¿™ä¸ªå¯å‚é˜… Linuxå®‰è£…é…ç½®è¯´æ˜ï¼Œç»“åˆgoogleï¼Œåº”è¯¥èƒ½å¤Ÿè§£å†³ã€‚</p>
<p>èƒ½å¤Ÿå¯åŠ¨ç³»ç»Ÿåï¼Œåœ¨ç›®æ ‡Linuxå†…æ ¸å¯åŠ¨é€‰é¡¹appendå‘½ä»¤ ro kgdboc=ttyS0,115200 kgdbwaitï¼Œå¦‚æ­¤ç›®æ ‡æœºå™¨å¯åŠ¨åˆ°ä¸€å®šæ—¶æœºåœæ­¢ï¼Œå‡ºç°kgdb: Waiting for connection from remote gdbâ€¦çš„å­—å¥ï¼Œè¿™æ ·å¯¹äºç›®æ ‡æœºå™¨çš„é…ç½®å·²ç»å®Œæˆï¼Œå†æ¥çœ‹ä¸»æœºé…ç½®ï¼Œå¯åŠ¨gdbé…ç½®ä¸²å£ï¼š</p>
<pre><code># åŠ è½½ vmlinux
cpp@dark:~/linux-2.6.34$ gdb vmlinux
GNU gdb 6.8
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later 
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;i486-slackware-linux&quot;...

# è®¾ç½®è¿œç¨‹ç«¯å£ æ³¢ç‰¹ç‡
(gdb) set remotebaud 115200
# è¿æ¥è¿œç¨‹ä¸²å£
(gdb) target remote /dev/pts/3
Remote debugging using /dev/pts/3
kgdb_register_io_module (new_kgdb_io_ops=)
    at kernel/kgdb.c:1749
1749            wmb(); /* Sync point after breakpoint */

# è‡³æ­¤ä¾¿å¯ä»»æ„è°ƒè¯•
(gdb)
</code></pre>
<p>è¿™é‡Œä¸²å£æˆ‘ä½¿ç”¨çš„æ˜¯ /dev/pts/3 æ˜¯å› ä¸ºæˆ‘åœ¨linuxä¸‹ä½¿ç”¨virtualboxè™šæ‹Ÿæœºçš„ç®¡é“ä¸²å£ï¼Œå†åˆ©ç”¨socatè™šæ‹Ÿä¸²å£ï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥ç›´æ¥åˆ©ç”¨ä¸»æœºä¸²å£ï¼Œè¿™é‡Œçš„è®¾å¤‡ä¾¿æˆä¸º /dev/ttyS0ï¼Œä½¿ç”¨socat è™šæ‹Ÿä¸²å£çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code># vboxS0 ä¸ºvirtualboxçš„ä¸²å£ç®¡é“
cpp@dark:~/kernel/socat-2.0.0-b4$ ./socat -d -d /tmp/vboxS0 pty:1
2010/12/10 23:24:14 socat[3962.3082070656] N opening connection to AF=1 &quot;/tmp/vboxS0&quot;
2010/12/10 23:24:14 socat[3962.3082070656] N successfully connected from local address AF=1 &quot;\x04\b\x94\x18\x@C\xAE\xB4\x@7\xE2\xA7\a&quot;
2010/12/10 23:24:14 socat[3962.3082070656] N successfully connected via
2010/12/10 23:24:14 socat[3962.3082070656] N PTY is /dev/pts/3
2010/12/10 23:24:14 socat[3962.3082070656] N starting data transfer loop with FDs [3,3] and [4,4]
</code></pre>
<p>è‡³æ­¤ä¾¿å¯ä½¿ç”¨kgdbè¿›è¡Œä¸²å£åŒæœºè°ƒè¯•ï¼Œè¿™é‡Œä½¿ç”¨linuxä¸»æœºå’Œè™šæ‹Ÿæœºå®ç°ï¼Œå½“ç„¶ç›¸åŒçš„æ€è·¯å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“å¦‚ä½•è¿›è¡Œä¸¤ä¸ªè™šæ‹Ÿæœºæˆ–è€…ä¸¤ä¸ªçœŸå®æœºè°ƒè¯•ã€‚</p>
<p>kgdb ä¹Ÿæ”¯æŒç½‘ç»œè°ƒè¯•ï¼Œä½¿ç”¨tcpåè®®ï¼Œä½†æ˜¯ä¸²å£åº”è¯¥æ˜¯æœ€ç†æƒ³çš„æ–¹å¼ï¼Œå¦‚æœéœ€è¦è°ƒè¯•ç½‘ç»œç¨‹åºï¼Œå†é€šè¿‡ç½‘ç»œä¼ è¾“è°ƒè¯•æŒ‡ä»¤ï¼Œä¼šä¸ä¼šæ··ä¹±å‘¢ï¼Ÿå…³äºkgdbï¼Œåœ¨ linuxå†…æ ¸æºç çš„æ–‡æ¡£éƒ¨åˆ† /linux-2.6.34/Documentation/DocBook/kgdb.tmpl ï¼Œæœ‰ä¸€åˆ†æ–‡æ¡£è¯´æ˜ï¼Œé…ç½®æ—¶å¯å‚é˜…ä¹‹ã€‚</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/linux%E5%86%85%E6%A0%B8/">Linuxå†…æ ¸</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/posts/program/linux%E5%86%85%E6%A0%B8/redis-failed-when-out-of-memory/">
        
        

        <div class="article-details">
            <h2 class="article-title">overcommit å¯¹ fork çš„å½±å“</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/program/linux%E5%86%85%E6%A0%B8/linux-kernel-process-sched/">
        
        

        <div class="article-details">
            <h2 class="article-title">Linuxå†…æ ¸ç¬”è®°-è¿›ç¨‹è°ƒåº¦</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/program/linux%E5%86%85%E6%A0%B8/linux-boot-protocol/">
        
        

        <div class="article-details">
            <h2 class="article-title">Linuxå†…æ ¸ç¬”è®°-å¯åŠ¨åè®®</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/program/linux%E5%86%85%E6%A0%B8/linux-vfs-source/">
        
        

        <div class="article-details">
            <h2 class="article-title">Linuxå†…æ ¸ç¬”è®°-VFS</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/program/linux%E5%86%85%E6%A0%B8/linux-kernel-interrupt-and-exception/">
        
        

        <div class="article-details">
            <h2 class="article-title">Linuxå†…æ ¸ç¬”è®°-ä¸­æ–­å’Œå¼‚å¸¸</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo=""
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 æ¶¸æ³½ä¹‹é±¼
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
